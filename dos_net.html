<!DOCTYPE html>
<html lang="en">
<head>
	
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<title>DoseNet @ UC Berkeley</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3"></script>
	<script src="http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerwithlabel/1.0/src/markerwithlabel.js" type="text/javascript"></script>
	<script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js"></script>
	<script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer.js"></script>
	<style text="text/css">

	@font-face { 
		font-family: 'Garamond';
		src: local('Garamond'), url('Garamond.ttf') format('truetype');
	}
	#map-canvas {
		width: 95%;
		min-height: 40em;
		height:	60em;
		margin-left: auto;
		margin-right: auto;
	}
	h5{
		padding: 0.5em 0 0 0;
		font-size: 1.5em;
		font-weight: bold;
		text-align: center;
	}
	h2{
		font-size: 3vw;
	}
	p {
		padding: 1em;
		font-size: 28px;
		font-weight: bold;
		text-align: center;
	}
	.header-text {
		font-size: 2vw;
		font-family: 'Garamond', Arial, sans-serif;
	}
	.header-image{
		width: 100%;
		max-width: 40em;
		min-height: 1em;
	}
	.plot{
		margin:1em;
		width:100%;
		min-width: 30em;
		max-width: 700px;
		min-height: 35em;
		max-height: 500px;
	}	
	.jumbotron{
		padding:0;
		margin: 1em;
	}
	.navbar{
		background-color : transparent;
	}
	.navbar-default{}
	.navbar-static-top{}
	.marker{
		height:1.5em;
	}
	.labels{
		background-color: #ffffff;
		background: rgba(255,255,255,0.95);
		-moz-border-radius: 5px;
		border-radius: 5px;
	}
	</style>
	<script>
	var map;
	var markers = [];
	var marks = [];
	var unitTime = "hour";
	var unitDose = "CPM";

	function initialize() {
		//Options fed into map initialiser
		options = {
			zoom: 16,
			center: new google.maps.LatLng(37.872269, -122.258901),
			mapTypeId: google.maps.MapTypeId.ROADMAP
		}
		map = new google.maps.Map(document.getElementById('map-canvas'),options);
	}

	function getTimeframe(){
		var sel_time = document.getElementById('time_dropdown');
		unitTime = sel_time.options[sel_time.selectedIndex].value;
	}

	function getUnit(){
		var sel = document.getElementById('dose_dropdown');
		unitDose = sel.options[sel.selectedIndex].value;
	}

	$(document).ready(function(){
		initialize();
		// To solve browser caching issue
		//var url = 'https://radwatch-test.berkeley.edu/sites/default/files/output.geojson?' + Math.random().toString(36).replace(/[^a-z]+/g, '');
		var url = 'output.geojson?' + Math.random().toString(36).replace(/[^a-z]+/g, '');

		$.getJSON(url, function(data){
			$.each(data.features, function(key, val){
				markers.push(val);
			});
			for(var i = 0; i < markers.length; i++ ) {
				//console.log(i);
				var curr = markers[i];
				var lat = curr.geometry.coordinates[1];
				var lon = curr.geometry.coordinates[0];
				var latest = "&nbsp"+(curr.properties["Latest dose (CPM)"]).toFixed(1)+"&nbsp";
				var LatLng = new google.maps.LatLng(lat,lon);
				var content = "";

				var marker = new MarkerWithLabel({
					map: map,
					title: name,
					position: LatLng,
					//animation: google.maps.Animation.DROP,
					labelContent: latest,
					labelAnchor: new google.maps.Point(5, 0),
					labelClass: "labels",
				});
				markers.push(marker);
				var infowindow = new google.maps.InfoWindow();

				/*google.maps.event.addListener(marker, 'mouseout', function(event){
					
				});*/

				google.maps.event.addListener(marker, 'click', (function(marker, i) {
				//google.maps.event.addListener(marker, 'click', (function(event) {
					return function(event) {
						if (unitTime == "hour") {
							if 		(unitDose == "CPM") {
								plotly_url = "URL_CPM_Hour";
								}
							else if (unitDose == "REM") {
								plotly_url = "URL_REM_Hour";
								}
							else if (unitDose == "USV") {
								plotly_url = "URL_USV_Hour";
								}
							}
						else if (unitTime == "day") {
								if 		(unitDose == "CPM") {
								plotly_url = "URL_CPM_Day";
									}
								else if (unitDose == "REM") {
								plotly_url = "URL_REM_Day";
								}
								else if (unitDose == "USV") {
								plotly_url = "URL_USV_Day";
								}
							}
						else if (unitTime == "month") {
							if 		(unitDose == "CPM") {
								plotly_url = "URL_CPM_Month";
								}
							else if (unitDose == "REM") {
								plotly_url = "URL_REM_Month";
							}
							else if (unitDose == "USV") {
								plotly_url = "URL_USV_Month";
							}
						}
						curr = markers[i];
						//"<br>"+ "Name: "+curr.properties["Name"]
						//"<br>"+"Latest dose (CPM): "+ curr.properties["Latest dose (CPM)"]
						//"URL: "+curr.properties[plotly_url.toString()]+"<br>"
						//"Latest measurement: "+"<br>"+curr.properties["Latest measurement"]+"<br>"
						content = "<iframe width=\"500\" height=\"400\" frameborder=\"0\" seamless=\"seamless\" scrolling=\"no\" src=\""+curr.properties[plotly_url.toString()]+".embed?width=500&height=400\"></iframe>";
						infowindow.setContent(content);
						infowindow.open(map, marker);
					}
				})(marker, i));
				marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png')
			}
			var markerCluster = new MarkerClusterer(map, markers);
		}); //End of $.getJSON(url, function(data)
	}) //End of $(document).ready(function()
</script>
</head>
<body>
	<div class="container-fluid">
		<nav class="navbar navbar-default navbar-static-top container header">
			<div class="jumbotron" style="padding:0.5em 2em 0em 2em; margin:0; background-color : transparent;">
				<img class="header-image img-responsive center-block" src="http://www.nuc.berkeley.edu/sites/default/files/theme/NE-Banner.png">
				<h5 class="header-text text-center">Dosimeter Network  -  UC Berkeley</h5>
			</div>
		</nav>
		
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-7" style="padding-left:0;">
				<h6> 
					<div>
						<label>
							<span class="label label-primary">
								Units to Display on Plots
							</span>
						</label>
						<select id="dose_dropdown" onChange='getUnit()'>
							<!-- <option value="" disabled="disabled" selected="selected">Please select a Dose Unit</option> -->
							<option value="CPM">CPM</option>
							<option value="REM">Millirem per Hour</option>
							<option value="USV">&microSv per Hour</option>
						</select>
						
						<label>
							<span class="label label-primary">
								Timeframe 
							</span>
						</label>
						<select id="time_dropdown" onChange='getTimeframe()'>
							<!-- <option value="" disabled="disabled" selected="selected">Please select the Length of Measurement</option -->>
							<option value="hour">Last Hour</option>
							<option value="day">Last Day</option>
							<option value="month">Last Month</option>
						</select>
						<span class="label label-info">
							Dosimeters - <img src='http://maps.google.com/mapfiles/ms/icons/red-dot.png' class="marker"></img>
							<!-- Dosimeters - <img src='https://radwatch-test.berkeley.edu/sites/default/files/marker.png' class="marker"></img> -->
						</span>
						
					</div>
				</h6>

				<div style="margin-left:1em" align=center id="map-canvas">
				</div>
			</div>
			
			<div id = "text_field" class="col-xs-12 col-sm-12 col-md-12 col-lg-5" align=center style="padding-left:0; padding-right:0; margin-bottom:1em;">
				<div class ="jumbotron" >
					<h5>
						Units Used
					</h5>
					<p>
						Background radiation is present everywhere. However, there are also many common, everyday human activities that expose you to radiation. The units used here are a sample of different sources of radiation in everyday activity and allow you to compare the background dose to these different activities.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="navbar navbar-default navbar-fixed-bottom">
		<div class="container">
			
			<span class="navbar-text text-left">
				Team: Joseph Curtis, Ryan Pavlovski, Navrit Bal, </br> Tigran Ter-Stepanyan, Mark Trudel, Nathan Richner, Luke Sheard
			</span>
			<span class="navbar-text pull-right">
				<button type="button" class="btn btn-link" onclick="map_explained()">How the Map Works</button>
				<button type="button" class="btn btn-link" onclick="about_radiation()">About Radiation</button>
				<button type="button" class="btn btn-link" onclick="about_dosnet()">About DosNet</button>
				
			</span>
		</div>
	</div>

	<script type="text/javascript">
	function map_explained() {
		document.getElementById("text_field").innerHTML = 
			"<div class =\"jumbotron\" >" +
			"<h5>" +
			"How the map works" +
			"</h5>" + 
			"<p>" + 
			"The map uses Google Maps with pinpoints at each dosimeter location. These dosimeters then update to show the current radiation level. Clicking on any of the points will bring up a new window, displaying more information about the individual detector and allow you to view the radiation level as a function of time. The units can be changed using the dropdown just above the map. These units show the background radiation level in terms of more familiar units." +  
			"</p>" + 
			"</div>"
	}

	function about_radiation(){
		document.getElementById("text_field").innerHTML = 
			"<div class =\"jumbotron\" >" + 
			"<h5>" + 
			"The radiation level is higher today than it was yesterday. Should I be concerned?" + 
			"</h5>" + 
			"<p>" + 
			"Probably not. In the same way that some days are windy and other days are calm, the background radiation level can change from day to day. What matters more than the dose each day is the overall trend in the dose over time." +  
			"<a href=\"http://www.epa.gov/radiation/understand/perspective.html\">EPA - Understand perspective</a>" + 
			"</p>" + 

			"<h5>" + 
			"Will I be okay from receiving radiation?" + 
			"</h5>" + 
			"<p>" + 
			"Very likely. Just as skin heals after a sunburn, the human body has ways of dealing with small amounts of radiation. Life on earth has existed with this background radiation for a very long time. In the same way life has adapted to sunlight, life has adopted to background radiation; it is a part of life and our bodies have mechanisms for repairing the damage that small doses cause." + 
			"</p>" + 
			"<h5>" + 
			"The area where I live seems higher than other areas, should I be concerned?" + 
			"</h5>" + 
			"<p>" + 
			"Different locations have different amounts of natural radiation background. The background in Denver, for example, is considerably higher compared to that at sea level. Some variation in background level is to be expected, just as different places have different weather." + 
			"</p>" + 

			"</div>";
	}

	function about_dosnet(){
		document.getElementById("text_field").innerHTML = 
			"<div class =\"jumbotron\" >" + 
			"<h5>" + 
			"About DoseNet" + 
			"</h5>" + 
			"<p>" + 
			"DoseNet is a collection of radiation detectors that are placed throughout the UC Berkeley campus and Berkeley area more generally. These dosimeters measure the amount of radiation that enters the detector and deposits energy every minute. This value is then converted to a count rate and used to calculate the amount of dose that is exposed to people.  Each dosimeter then takes this measurement and sends it to a central server, where it is displayed on RadWatch.  This system is unique in that it allows for real-time monitoring of radiation levels." + 
			"</p>" + 
			"</div>";
	}

	sv_time = "hour";
	function get_timeframe(){
		var sel_time = document.getElementById('time_dropdown');
		sv_time = sel_time.options[sel_time.selectedIndex].value;
	}

	sv = "CPM";
	function get_unit_type(){
		var sel = document.getElementById('dose_dropdown');
		sv = sel.options[sel.selectedIndex].value;
		switch(sv) {
			case 'plane':
			document.getElementById("text_field").innerHTML = 
				"<div class =\"jumbotron\">" +  
				"<h5>" + 
				"Minutes on Airplane (2.38 µSv per hour)" +  
				"</h5>" +  
				"<p>" + 
				"Radiation also comes from the sun, solar wind, and other cosmic radiation. The bulk of this radiation is blocked by the Earth’s atmosphere. However, when flying across the country, the increased altitude means the air is thinner. With thinner air, there is less protection from this cosmic radiation. This means that while flying in an airplane, you receive a higher dose of radiation than you would on the ground. This unit compares how many minutes on an airplane would give you the same dose as standing at this location for 10 minutes. <a href=\"http://www.hps.org/publicinformation/ate/faqs/commercialflights.html\">HPS Public information</a>" + 
				"</p>" +  
				"</div>";
			break;
			case 'medical':
			document.getElementById("text_field").innerHTML = 
				"<div class =\"jumbotron\">" +  
				"<h5>" + 
				"Medical Procedures" + 
				"</h5>" + 
				"<p>" + 
				"Getting x-rayed at the dentist’s office or getting CT scans at a hospital are common occurrences. These forms of imaging help doctors see inside the body and allow them to more easily do their jobs. However, such procedures do expose one’s body to some dose of radiation. This amount varies from procedure to procedure. The units here compare how many of each type of image would need to be taken to give you the same dose as standing at this location for 10 minutes." + 

				"Dental X-Ray (5 to 15 µSv)" + 
				"Hand X-Ray (5 uSv)" + 
				"Chest CT Scan (7mSv)" + 
				"<a href=\"http://www.radiologyinfo.org/en/pdf/sfty_xray.pdf\">Radiology information</a>" + 
				"<a href=\"http://www.nrc.gov/about-nrc/radiation/around-us/doses-daily-lives.html\">NRC - Daily lives</a>" + 
				"</p>"
				"</div>";
			break;
			case 'mREM/hr':
			document.getElementById("text_field").innerHTML = 
				"<div class =\"jumbotron\">" + 
				"<h5>" + 
				"Millirem per hour (mREM/hr) - 1 mREM/hr = 10 µSv/hr" + 
				"</h5>" + 
				"<p>" + 
				"The millirem (equal to 1/1000th of a rem) is an older measurement of radiation dose that the Sievert replaced. It is still common  however, in the literature on radiation dose. Because of this, it is included in here as well. The mREM/hr unit is the dose rate - the dose absorbed per hour of exposure." + 
				"</p>" + 
				"</div>";
			break;
			case 'uSv/hr':
			document.getElementById("text_field").innerHTML = 
				"<div class =\"jumbotron\">" + 
				"<h5>" + 
				"Micro-Sievert per hour (µSv/hr)" + 
				"</h5>" + 
				"<p>" + 
				"The Sievert is the standard (SI) unit of absorbed dose. It is related to the amount of energy that radiation deposits in the body. 1 Sv is defined as being 1 joule of energy that is absorbed in 1 kg of tissue. 1 µSv is equal to 10^-6 (0.000001) Sv. Sv/hr is the dose rate - the dose absorbed per hour of exposure." + 
				"</p>" + 
				"</div>";
			break;
			default:
			document.getElementById("text_field").innerHTML = "...";
		}

	}
	</script>

</body>
</html>